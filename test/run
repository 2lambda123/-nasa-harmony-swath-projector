#!/bin/sh

# Exit status used to report back to caller
#
STATUS=0

export HDF5_DISABLE_VERSION_CHECK=1

# Run the standard set of unittests
#
coverage run -m unittest discover test
RESULT=$?
if [ "$RESULT" -ne "0" ]; then
    STATUS=1
    echo "ERROR: unittest generated errors"
fi


coverage xml -o test/reports/coverage.xml


# Run pylint
#
pylint pymods swotrepr.py --disable=E0401 --extension-pkg-whitelist=netCDF4
RESULT=$?
RESULT=$((3 & $RESULT))
if [ "$RESULT" -ne "0" ]; then
    STATUS=1
    echo "ERROR: pylint generated errors"
fi



# Run the python safety check
#
safety check
RESULT=$?
if [ "$RESULT" -ne "0" ]; then
    STATUS=1
    echo "ERROR: safety check generated errors"
fi



exit $STATUS
